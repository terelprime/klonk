<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
  <head>
    <title>Help</title>
    <style type="text/css">
      body {
        font-size:12px;
        font-family:"Arial Unicode MS",Helvetica,Geneva;
        font-color:black;
      }
      h2  { margin:10px 10px 2px 10px; font-style:bold; font-size:16px}
      h3  { margin:2px 10px 2px 10px; font-style:bold; font-size:14px}
      p   { margin:0px 10px 6px 10px; }
      pre { margin:0px 10px 6px 10px; }
    </style>
  </head>
  <body>

<h2>Contents</h2>
<ul>
  <li><a href="#intro">Introduction</a></li>
  <li><a href="#switch">The Switch Menu, AKA Where Are My Tabs?</a></li>
  <li><a href="#find">Find & Replace</a></li>
  <li><a href="#undo">Undo</a></li>
  <li><a href="#align">The "Align" Menu</a></li>
  <li><a href="#filetypes">Supported File Types</a></li>
  <li><a href="#batch">External → Run Batch Program</a></li>
  <li><a href="#config">Command-Line Parameters, Configuration, Logging & Your Home Directory</a></li>
  <li><a href="#status">The Status Bar</a></li>
  <li><a href="#encryption">Encryption</a></li>
  <li><a href="#ssh">SSH</a></li>
  <li><a href="#filefind">Find Files</a></li>
  <li><a href="#shutdown">Shutting Down Klonk</a></li>
  <li><a href="#keys">Other Shortcut Keys</a></li>
  <li><a href="#macos">Macintosh Quirks</a></li>
</ul>

<h2><a name="intro">Introduction</a></h2>

<p>
This describes hidden shortcuts and confusing features that you might not expect or understand.
</p>


<h2><a name="switch"> The Switch Menu, AKA Where Are My Tabs? </a></h2>

<p>
Klonk does not use tabs, in part because they tend to become unreadable when editing a lot of files. It can still open many files at once, however. The Switch menu allows one to switch between different files.
</p>

<p>
The main part of the Switch menu is displayed alphabetically for ease of reading, but the files are also tracked according to which was most recently viewed. All file names are shown in the main section, but the names of the current, 2nd & 3rd most recent files are also displayed in an extra section at the top of the switch menu for convenience. As per the menu, F12 is a keyboard shortcut for switching to the 2nd. Pressing F12 repeatedly will switch back & forth between the top two files.
</p>

<p>
Also, as per the menu, F11 (⌘-` on OSX)  will send the current file to the "back", and Shift-F11 (Shift-⌘-` on OSX) will send the back to the "front" so that it becomes the current file. Thus F11 and/or Shift-F11 can be used to cycle quickly through all open files.
</p>


<h2><a name="find"> Find & Replace </a></h2>

<h3>"Find Again"</h3>
<p>
As per the top menu & standard practice, when the Find & Replace window is closed, F3 / (⌘-G on OSX) will automatically re-invoke a find/replace operation using the last criteria entered.
</p>

<p>
When the Find & Replace window is open, F3 also acts as a shortcut for the "Find" button; Shift-F3 (Shift-⌘-G on OSX) acts as a shortcut for the "Find backwards" button. Furthermore, when "Confirm replace" is turned on, F3 and Shift-F3 are shortcuts for the "Yes" button.
</p>

<p>
The net effect is that you can use F3/Shift-F3 to initiate, confirm and/or repeat by repeatedly pressing the same button(s). Press ESC in the confirmation window to skip a given replacement and press F3/Shift-F3 again to continue to the next replacement. You can switch directions without going back to the main Find & Replace window by just switching between F3 & Shift-F3.
</p>

<h3> Regular Expressions</h3>
<p>
The "Regular expression" checkbox tells Klonk to use the standard Java regex syntax, which is slightly different from other languages, but mostly based on Perl. Explaining regular expressions is beyond the scope of this document, but Google for "java.util.regex.Pattern" and you will find the official documentation.
</p>

<p>
The java flags Pattern.MULTILINE & Pattern.DOTALL are turned on by default, because this gives the most intuitive results. Among other things, this means the "^" and "$" special characters don't work, but you can still use "\n" to match the end of a line. Use the "Multi-line + Dot-All" checkbox to turn these off (you can selectively re-enable them using "(?m)" and/or "(?s)" in your regex as per the official documentation).
</p>

<p>
Also note that when using find-replace with regular expressions, a "$" and number - e.g. "$1" - in your replacement text will be interpreted as a "backreference" to a "group". If that is not what you intended, or you have no idea what it even means, you can prevent errors by quoting the "$" with a "\", like so:
</p>
<pre>  \$</pre>

<p>
If you are actually trying to do a backreference, they typically look like this:
</p>

<pre>  $1 $2 $3 </pre>

<p>
not
</p>

<pre>  \1 \2 \3 </pre>

<p>
They are explained in the documentation for java.util.regex.Matcher (not Pattern!) (google for it or hunt through the links on Pattern's web page).
</p>

<h3> Ctrl-Enter, Ctrl-Tab</h3>
<p>
The find/replace text boxes are reasonably capable mini-editors similar to the main window editor, but a few things are different:
</p>

<p>
In a typical dialog box, it is more familiar to use Enter to submit the action, and Tab/Shift-Tab to switch controls. So if you want to insert a line break or tab character instead, use Ctrl-Enter & Ctrl-Tab, respectively.
</p>

<p>
Also, the auto-indent and tab-indents-line features found in the main editor do not work in the find/replace text boxes.
</p>


<h2><a name="undo"> Undo </a></h2>

<p>
The "Undo" menu describes a variety of undo options, but the most important operations, undo and redo, are in the text editor's right-click/context menu; as you should expect, their shortcuts are Ctrl-Z and Shift-Ctrl-Z (⌘-Z and Shift-⌘-Z on OSX).
</p>

<p>
Unlike most editors & IDE's, Klonk allows "unlimited" undo capability, where all edit states are preserved. Like most editors, when you undo a series of edits, you have the option to redo them, undo them again, and so on, backwards and forwards; but in Klonk if you undo and start making new edits, the redos are preserved by converting them into undos. So if you type
</p>
<pre>  ABCD</pre>

<p>
then undo to
</p>
<pre>  AB</pre>

<p>
then add some new text to create
</p>
<pre>  AByz</pre>

<p>
then undo back to the beginning, you will see the following states:
</p>
<pre>  AByz ABy AB ABCD ABC AB A</pre>

<p>
Also note that going to "Undo" → "Use fast undos" in the top menu turns on/off the ability to go through multiple undo/redos in one operation, for convenience. With this feature on, undo/redo will not happen one character at a time as shown above, but the results are effectively the same.
</p><p>
Finally, "Undo" → "Undo to history switch" in the top menu helps with those cases where you've undone something, rewrote, and now changed your mind again: It will take you to the point where you went back in "time" and changed "the past". The "Redo to history switch" menu selection does the same thing, but in the opposite direction.
</p>

<h3> Ctrl-Y</h3>
<p>
As noted earlier, the designated Redo shortcut is Shift-Ctrl-Z, but Ctrl-Y will also work since that is also a common/standard shortcut.
</p>


<h2><a name="align"> The "Align" Menu </a></h2>

<p>
The "Align" menu is not very intuitive-looking, but its purpose is to allow one to quickly insert or delete spaces in the middle of a line to align to a nearby line. For example, you can change
</p>
<pre>  aabbcc=3;
  aa=4;</pre>

<p>
to
</p>
<pre>  aabbcc=3;
  aa    =4;</pre>

<p>
by putting the cursor right before "=4" and pressing Ctrl-Spacebar, the shortcut for "Insert spaces to align cursor to above". If the order of the lines was reversed, you would press Ctrl-Shift-Spacebar instead, which aligns to a line <i>below</i> instead of <i>above</i>. If the lines looked like this:
</p>
<pre>  aabbcc=3;
  aa       =4;</pre>

<p>
then you could put the cursor to the left of "=4" and press Ctrl-Backspace to get the same alignment, or press Ctrl-Shift-Backspace if the order of the lines is reversed.
</p>

<p>
When doing this, Klonk's algorithm looks for a position to align to based on where the breaks between words and/or special characters are. If such can't be found on the very next line above/below, Klonk will look scan up to several lines further above/below looking for a spot to align to.
</p>


<h2><a name="filetypes"> Supported File Types </a></h2>

<p>
Officially, Klonk supports the following types of text file encoding:
</p>
<pre>  ASCII
  UTF-8
  UTF-16 Big-Endian
  UTF-16 Little-Endian</pre>

<p>
This means Klonk should be able to read any Microsoft-generated text file without trouble. It even accepts Microsoft's somewhat-non-standard version of UTF-8 (and preserve Microsoft's non-standard Byte Order Mark when saving if it found such when opening a UTF-8 file).
</p>

<p>
This also means that Klonk does a reasonably good job with files containing Unicode characters, for example the famous Unicode Snowman, which may or may not work here:
</p>
<pre>  ☃</pre>

<p>
Such characters only display properly if you have selected a font that can handle them, however. Go to "Options" → "Font & colors" to change your font (on Microsoft Windows, "Arial Unicode MS" is a reliable choice).
</p>


<h2><a name="batch">External → Run Batch Program</a></h2>

<p>
This allows you to run a program and pipe the standard output/error back into Klonk. It is pretty good as a poor person's substitute for an IDE compiler (whatever that means). Warning: For some programs the "Stop" button is not very good at killing the program, in which case you may have to end the program using the operating system's features (like Unix/Linux/OSx's "kill -9", etc.).
</p>

<p>
Note that when using this to run an external java program, it may help to use the
</p>
<pre>  -Xshare:off </pre>
<p>
java parameter to avoid conflicting with Klonk's memory.
</p>

<p>
Previously entered commands are stored in the dropdown list and also saved to disk when you exit klonk, so you can quickly get them back in a later edit sessions. This only happens if the operating system can find the command you asked it to run, however. To clear out clutter, click the "Forget" button to remove the currently selected command from the list.
</p>

<p>
Finally, if "[$1]" appears as part of the command, it will be substituted with the name of the current file. For example, if you are editing a script, you could type something like
</p>
  <pre>  powershell.exe [$1]</pre>
<p>
or
</p>
  <pre>  bash -c [$1]</pre>
<p>
to execute it.
</p>

<h3>ALT-D &amp; ALT-L</h3>
<p>
Similar to a web browser's address bar, this keystroke transfers focus to the dropdown list of commands. And as with the web browser, if varies by operating system.
</p>


<h2><a name="config">Command-Line Parameters, Configuration, Logging & Your Home Directory</a></h2>

<p>
Klonk will open any file whose name is passed to it on the command line.
</p>

<p>
Configuration data and so on is stored in a directory named "klonk" in your home directory, which is automatically detected. You can specify an alternate home directory using
</p>
  <pre>  -home [directory name]</pre>
<p>
as a command-line option. This actually allows you to run multiple Klonks at the same time, by just running each with an alternate home. Right now Klonk's home directory is set to:
</p>
  <pre>  $[Home]</pre>
<p>
Note that a file named Klonk.properties is stored in this directory. You can modify your settings directly (albeit carefully) or remove them entirely to reset to the application defaults.
</p>
<p>
Also, Klonk will write a log to this directory, as "log.txt". This can be helpful when diagnosing problems.
</p>


<h2><a name="status">The Status Bar</a></h2>

<p>
Popup windows are annoying. The status bar at the bottom of Klonk's main window is often used to pass along information that does not require a decision from the user. So if you're expecting some kind of notification and don't get one, look at the status bar.
</p>

<p>
Note that the status bar also has a red "CAPS LOCK" indicator. Thanks to a bug in the Java runtime, this may not immediately turn on/off when you switch to another application, press Caps Lock and then go back to Klonk. After the first keyboard action or mouse click it will "synchronize" and display correctly.
</p>

<h2><a name="encryption">Encryption</a></h2>

<p>
Klonk features Password-Based Encryption (PBE) via the Rinjdael cipher, also sort-of-known as AES. This is available via the File → Encrypt dialog. Per the AES specification, you can select 128, 192, or 256-bit encryption; more bits is better, but 128 (the default) is recognized as good enough until quantum computing becomes accessible. To use 192 or 256 bits, you need a Java Virtual Machine that allows larger keys (OpenJDK or install the Oracle Unlimited JCE).
</p>
<p>
Encrypted files are stored as base64-encoded text, with a "flag" string at the top to identify them. Klonk will automatically prompt you for an encryption password upon recognizing an encrypted file.
</p>


<h2><a name="ssh"> SSH </a></h2>

<p>
Klonk includes the ability to connect to servers over SSH and use SFTP/SSH to read and write files. This is convenient when working with Unix/Linux servers that don't support better file sharing options.
</p>

<p>
To connect to an SSH server's file system, you can do one of two things:
<ol>
  <li>Enter the name like so in the File → Open dialog:
  <pre>  ssh:user@server.domain.domain/path1/path2/etc</pre>
  If you leave the path out, klonk will attempt to start with your home directory. If you leave the user out, klonk will prompt you for a user. It will also prompt you for a password as necessary.
  </li>
  <li>Go to File → Save to → SSH, or File → Open from → SSH.</li>
</ol>
</p>

<p>
SSH behavior can be configured by going to Options → SSH in the menu:
<ol>

<li>
You can set a "Known hosts" file. Klonk can't generate this file, but but most other SSH clients will as you connect to different servers, collecting "fingerprints" of your favorite SSH servers and warning/failing if they suddenly change (which may mean a man-in-the-middle attack). You don't <i>have</i> to do this, but it is widely considered to be a Very Good Thing.
</li>

<li>
Since typing passwords is a hassle, it's a good idea to set up private/public key arrangement for SSH. Klonk does not have this ability built-in, so you will need to create the files using your favorite SSH client. Klonk will need the location of your "private keys" file, which you can enter here. You can also enter the location of your "known hosts" file, which is not absolutely necessary but is considered important for security reasons.
</li>

<li>
You can select an OpenSSH Config file, which provides a few conveniences. The most important thing is that you can configure shortcut hostnames like so:
<pre>
# Refer to linux man page on ssh_config; note that a limited subset of features are supported, unfortunately
# not including ProxyCommand :(
Host derp
     HostName derpity.derpity.derp.derp.derp.org
</pre>
and then just use "derp" as a hostname whenever you want to connect to derpity.derpity.derp.derp.derp.org.
</li>

<li>
You can set the default permissions to be assigned when you create a new file or directory (your remote umask setting is unfortunately ignored).
</li>

<li>
You can disconnect open connections, which are otherwise left open until you exit Klonk.
</li>
</ol>
</p>


<p>
<b>Important note</b>: Modern ssh servers tend to use very large ssh keys. Your local java installation most likely won't support this by default, and you'll get funky errors about ssh keys and/or algorithms when trying to connect.  The fix is relatively easy: Google for the official JCE (Java Cryptography Extension), and follow the instructions; this involves downloading a couple files and copying them into your java installation folder.
</p>
<p><b>But wait there's more:</b> Once you've fixed the problem with very large ssh keys, you may have more problems with your known_hosts file (as per #1), especially with Debian Linux servers. Klonk will complain about an "RSA fingerprint" not matching what you have, and when you look in your known_hosts, you see "ecdsa-sha2-nistp256" instead of "ssh-rsa". The way to fix this is by creating an OpenSSH config file that sets the "priority" for known_hosts signatures as follows:
</p>
<pre>
Host *
  HostKeyAlgorithms ecdsa-sha2-nistp256,ssh-rsa,ssh-dss
</pre>
<p>This can be done using the OpenSSH Config File option as described in #3 above.
</p>

<p>Finally, note that Klonk uses the JCraft JSCH SSH library to gain SSH connectivity, so when diagnosing problems with SSH you may find it helpful to look for similar issues others have had with that library. </p>


<h2><a name="filefind">Find Files</a></h2>
<p>File find is case-insensitive (because most of the time you won't care), and you can open more than one file.

<p>The "Find" box expression has two rules:

<p>1. The standard wildcard "*" character can be used, as in "PersonNamed*.txt"
<p>2. Any white space designates multiple expressions, so "abc hello*money def" will match file names that contain each of "abc", "hello*money" and "def", in any order.

<p>The "Exclude" box is almost exactly the same, except on rule 2 it's <i>any</i> instead of <i>all</i>, i.e. "/.git/ /build/" will skip files in both the ".git" and "build" directories.

<h2><a name="shutdown">Shutting Down Klonk</a></h2>

<p>
When you you exit Klonk it will stop and ask you to save any files that have unsaved changes. You will also notice that Klonk shows a small red bar at the upper left if the current file has unsaved changes, and/or an adjoining blue bar if this or another file has unsaved changes.
</p>

<p>
However, many folks are used to hitting the power-off/restart button on their workstation and waiting to see which applications throw up alert windows to warn about unsaved changes. Unfortunately the Java runtime doesn't have any facility for "hooking" a shutdown message and telling the operating system to wait. Thus Klonk will briefly flash a popup warning about unsaved changes and then get killed by the OS before you have a chance to do anything.
</p>

<p>
Also, when the OS kills it, Klonk won't get a chance to save its configuration first. Most configuration options are saved as soon as you change them, but a few things that change rapidly are not (mainly window position & size). This won't cause data corruption/loss/etc., but doing a clean exit guarantees the app returns to the exact same configuration after restart.
</p>

<h2><a name="keys"> Other Shortcut Keys </a></h2>

<h3> Tab & Shift-Tab</h3>
<p>
As is common in text editors, these keystrokes indent and un-indent by default; press Ctrl-Tab to actually insert a tab character. Go to "Options" → "Tabs & indents" in the top menu to customize/disable this behavior.
</p>

<h3> Shift-Right-arrow, Shift-Left-arrow: </h3>

<p>
As is also common in text editors, these keys expand or contract the current selection by one character to the left or right depending on where the cursor is.
</p>

<p>
Adding in the Ctrl button accelerates the action, jumping over multiple characters at a time. Ctrl-Left/Right-arrow alone jumps over characters without selecting them. On Macintosh/OSX you can also press Option instead of Ctrl (both work).
</p>

<p>
As a bonus, if you start with any one of the following characters:
</p>

  <pre>   [{"</pre>

<p>
then Shift-Ctrl-Right/Left-arrow will try to find a matching character to close it, so that the number of opening/closing characters in between matches. This only works if all characters are on the same line, however.
</p>


<h3> ESC</h3>
<p>
As is typical, ESC will close a dialog/popup window without taking action, effectively the same as hitting a "Cancel" (or in some cases, "Close") button.
</p>

<h3> Ctrl-W on MS Windows</h3>
<p>
The primary shortcut for closing the current file is Ctrl-F4, but since Ctrl-W is also a common shortcut for this type of action, it is supported as well.
</p>

<h2><a name="macos"> Macintosh Quirks </a></h2>
<p>
You may have found yourself in the unfortunate position of using an Apple computer like myself. This creates challenges...
</p>

<h3>Minor challenges</h3>
<ul>
<li>In the top menu, Apple insists on creating a "Klonk" menu that Klonk itself has little control over. This includes an incorrect "About" menu item (the correct one is over at the right under "Help").</li>
<li>
In the "Help" menu, Apple places a useless search box.
</li>
</ul>

<h3>Command-line invocation</h3>
<p>Opening files from the MacOS command-line terminal is not so great; we use a bash script to make it better:
</p>
<ol>
<li>Find the famous "brew" application on the internet and install it</li>
<li>Get gnu coreutils, which gives us the greadlink command<pre>
  brew install coreutils
</pre></li>
<li>Put this bash script in a file, called, say "edit"<pre>
  app="/Applications/Klonk.app/Contents/MacOS/Klonk"
  if [[ $1 == "" ]]
  then
    $app &
  else
    greadlink -f "$@" | xargs $app &
  fi
</pre></li>
<li>Make sure that file is in our path and executable (setting your $PATH and using the chmod command... you can google for those)</li>
</ol>

<h3>Menu Shortcuts</h3>
<p>Long story short, unlike Microsoft, Apple makes it really hard to access menu items via the keyboard. So we created the "MacOS shortcuts" menu, which lists a series of items that are already in <i>other</i> menus, but here they have designated keyboard shortcuts that instantly take you to a "popup" menu (as opposed to a sub-menu). This may sound confusing at first, but it's recommended for keyboard hogs who hate mousing thru menus.
</p>
<p>Also note that we ended up having to change a lot of keyboard shortcuts (all of which are visible in menus), which might bother someone used to the Windows ones. Some of the Windows shortcuts do actually work, however: F3, F4, F8, F9, F11, Ctrl-G, Ctrl-F, Ctrl-R, and maybe a few more.

</body>
</html>